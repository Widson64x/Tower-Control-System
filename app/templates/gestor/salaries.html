{% extends "base.html" %}
{% block content %}

<style>
    .salary-card {
        transition: box-shadow .2s, transform .2s;
        border-radius: 1.2rem;
        background: linear-gradient(120deg, #f8fafc 80%, #e0e7ef 100%);
    }
    .salary-card:hover {
        box-shadow: 0 4px 32px 0 rgba(0,80,150,0.07), 0 2px 8px 0 rgba(0,80,150,0.04);
        transform: translateY(-6px) scale(1.03);
        border: 1px solid #2c90ff22;
    }
    .salary-avatar {
        width: 70px;
        height: 70px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: auto;
        border-radius: 50%;
        overflow: hidden;
        background: #fff;
        box-shadow: 0 0 0 3px #0d6efd33;
        border: 2px solid #e3e9f4;
    }

    .salary-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;  /* Garante que preenche o círculo e mantém o foco central */
        object-position: center;
        border-radius: 50%; /* Garante o círculo mesmo se a imagem não for quadrada */
        display: block;
        background: #f3f6f9;
    }
    .btn-salario-cta {
        position: fixed;
        right: 2rem;
        bottom: 2.5rem;
        z-index: 50;
        border-radius: 999px;
        box-shadow: 0 2px 12px 0 #0d6efd44;
        font-weight: bold;
        font-size: 1.25rem;
        transition: background .15s, box-shadow .2s, transform .15s;
    }
    .btn-salario-cta:hover {
        background: linear-gradient(90deg, #54d6ff 40%, #0d6efd 80%);
        color: #fff !important;
        transform: scale(1.07) translateY(-2px);
        box-shadow: 0 4px 32px 0 #0d6efd55;
    }
    .filter-panel {
        border-radius: 1.2rem;
        box-shadow: 0 2px 18px 0 #b6c9ef13;
        background: #fff;
        padding: 2rem 2.5rem 1.3rem 2.5rem;
        margin-bottom: 2.5rem;
        display: flex;
        flex-wrap: wrap;
        gap: 2.5rem 1.8rem;
        align-items: end;
    }
    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        min-width: 170px;
    }
    .filter-title {
        font-size: 1rem;
        font-weight: 600;
        color: #1877f2;
        margin-bottom: 0.3rem;
        letter-spacing: .03em;
    }
    .filter-btns {
        display: flex;
        gap: 0.4rem;
        flex-wrap: wrap;
    }
    .btn.filter-btn {
        border-radius: 1em;
        font-weight: 500;
        padding: 0.38em 1.1em;
        background: #f4f8fb;
        color: #3494e6;
        border: 1px solid #e3e9f4;
        transition: .15s;
    }
    .btn.filter-btn.active, .btn.filter-btn:active {
        background: linear-gradient(90deg, #4facfe 40%, #00f2fe 100%);
        color: #fff;
        border-color: #4facfe;
        font-weight: 700;
        box-shadow: 0 2px 8px #4facfe26;
    }
    .btn.filter-btn:hover {
        background: #e8f4fa;
        color: #2c69d3;
    }
    .form-control:focus, .btn:focus {
        box-shadow: 0 0 0 2px #64e7fa22;
        border-color: #66d9ef;
    }
    .badge-modern {
        font-size: .97em;
        padding: .35em .75em;
        border-radius: 999px;
        font-weight: 500;
    }
    .salary-card .btn-primary, .salary-card .btn-success {
        border-radius: 1.5em;
        padding-left: 1.3em;
        padding-right: 1.3em;
        font-weight: 500;
        transition: background .15s, transform .13s;
    }
    .salary-card .btn-primary:hover {
        background: linear-gradient(90deg, #54d6ff 40%, #0d6efd 80%);
        color: #fff;
        transform: scale(1.06);
    }
    @media (max-width: 575px) {
        .salary-card { border-radius: .8rem; }
        .search-filtros { padding: 1rem 1rem; }
    }
</style>

<h2 class="mb-4 text-primary fw-bold"><i class="bi bi-cash-coin"></i> Gestão Moderna de Salários</h2>

<!-- FILTROS -->
<form method="get" class="filter-panel">

    <div class="filter-group flex-grow-1" style="min-width:220px;">
        <label for="search" class="filter-title">Buscar funcionário</label>
        <div class="input-group">
            <span class="input-group-text bg-white border-end-0"><i class="bi bi-search"></i></span>
            <input type="text" class="form-control border-start-0" id="search" name="search" placeholder="Nome ou e-mail..." value="{{ search or '' }}">
        </div>
    </div>
    
    <div class="filter-group">
        <span class="filter-title">Status</span>
        <div class="filter-btns">
            <button name="status" value="" type="submit" class="btn filter-btn {% if not status %}active{% endif %}">Todos</button>
            <button name="status" value="ativo" type="submit" class="btn filter-btn {% if status == 'ativo' %}active{% endif %}">
                <i class="bi bi-person-check"></i> Ativo
            </button>
            <button name="status" value="inativo" type="submit" class="btn filter-btn {% if status == 'inativo' %}active{% endif %}">
                <i class="bi bi-person-x"></i> Inativo
            </button>
        </div>
    </div>
    
    <div class="filter-group">
        <span class="filter-title">Salário</span>
        <div class="filter-btns">
            <button name="salario" value="" type="submit" class="btn filter-btn {% if not salario %}active{% endif %}">Todos</button>
            <button name="salario" value="com" type="submit" class="btn filter-btn {% if salario == 'com' %}active{% endif %}">
                <i class="bi bi-cash-stack"></i> Com
            </button>
            <button name="salario" value="sem" type="submit" class="btn filter-btn {% if salario == 'sem' %}active{% endif %}">
                <i class="bi bi-cash"></i> Sem
            </button>
        </div>
    </div>
    
    <div class="filter-group" style="min-width:120px;">
        <span class="d-block" style="height:1.5rem;"></span>
        <div class="d-flex gap-2">
            <button type="submit" class="btn btn-outline-primary fw-semibold shadow-sm px-3">
                <i class="bi bi-funnel"></i> Filtrar
            </button>
            <a href="{{ url_for('salary.salaries_list') }}" class="btn btn-outline-secondary px-3">
                <i class="bi bi-x-circle"></i> Limpar
            </a>
        </div>
    </div>
</form>

<!-- CARDS MODERNOS -->
<div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4">
    {% for user in usuarios %}
    <div class="col d-flex align-items-stretch">
        <div class="card salary-card w-100 shadow-sm mb-2 d-flex flex-column">
            <div class="card-body d-flex flex-column justify-content-between align-items-center">
                {% set caminho_img = user.profile_picture %}
                {% if not caminho_img or caminho_img.startswith('C:') %}
                    {% set caminho_img = 'imgs/uploads/picture/use_default.png' %}
                {% endif %}
                <div class="salary-avatar mb-3">
                    <img src="{{ url_for('static', filename=caminho_img) }}"
                        alt="Foto de perfil de {{ user.nome }}"
                        class="img-fluid rounded-circle"
                        width="56" height="56"
                        style="object-fit: cover; border-radius:50%; border:2px solid #e3e9f4;">
                </div>
                <h5 class="card-title mb-1 fw-semibold">{{ user.nome }}</h5>
                <p class="text-muted small mb-1">{{ user.email }}</p>
                <div class="mb-2">
                    {% if user.active %}
                        <span class="badge badge-modern bg-success"><i class="bi bi-person-check"></i> Ativo</span>
                    {% else %}
                        <span class="badge badge-modern bg-secondary"><i class="bi bi-person-x"></i> Inativo</span>
                    {% endif %}
                </div>
                {% if user.salary %}
                    <div class="mb-2">
                        <span class="badge badge-modern bg-info text-dark shadow-sm">
                            <i class="bi bi-currency-dollar"></i> R$ {{ "%.2f"|format(user.salary.valor) }} {{ user.salary.moeda }}
                        </span>
                        <div class="text-muted small mt-1">
                            <i class="bi bi-calendar-event"></i> {{ user.salary.data_inicio.strftime('%d/%m/%Y') }}<br>
                            <i class="bi bi-person-workspace"></i> {{ user.salary.gestor.nome }}
                        </div>
                    </div>
                    <button class="btn btn-success btn-sm mt-2" disabled>
                        <i class="bi bi-check-circle"></i> Salário cadastrado
                    </button>
                {% else %}
                    <div class="mb-2">
                        <span class="badge badge-modern bg-warning text-dark shadow-sm">
                            <i class="bi bi-exclamation-triangle"></i> Não cadastrado
                        </span>
                    </div>
                    {% if user.active %}
                    <a href="{{ url_for('salary.salary_novo') }}?user_id={{ user.id }}" class="btn btn-primary btn-sm mt-2 animate__animated animate__pulse">
                        <i class="bi bi-plus-circle"></i> Cadastrar Salário
                    </a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if not usuarios %}
    <div class="alert alert-info mt-4 text-center shadow-sm border-0">
        <i class="bi bi-emoji-frown text-primary" style="font-size:2.2rem;"></i>
        <br>
        <span style="font-size:1.1rem;">Nenhum funcionário encontrado para esse filtro.</span>
    </div>
{% endif %}

<a href="{{ url_for('salary.salary_novo') }}" class="btn btn-salario-cta btn-primary">
    <i class="bi bi-plus-circle"></i> Novo Salário
</a>
{% endblock %}
